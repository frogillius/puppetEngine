<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixiJS JSON Loader</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"></script>
    <style>
      body {
          margin: 0;
          overflow: hidden; /* Optional: Prevents scrolling */
      }
  </style>
  
</head>
<body>
    <script>
      const app = new PIXI.Application({
        width: window.innerWidth,
        height: window.innerHeight,
        backgroundColor: 0x1099bb
    });
    document.body.appendChild(app.view);
    
    // Create a container for the doll and center it
    const dollContainer = new PIXI.Container();
    app.stage.addChild(dollContainer);
    
    let zoomLevel = 3.0; // Starts at full size (1.0)
    
    // Function to center and scale the doll
    function updateDollTransform() {
        dollContainer.x = app.renderer.width / 2;
        dollContainer.y = app.renderer.height / 2;
        dollContainer.scale.set(zoomLevel);
    }
    
    // Load the JSON file and add the doll
    fetch('fallback.json')
        .then(response => response.json())
        .then(data => {
            loadPart(data.hips, dollContainer);
            updateDollTransform(); // Center and apply zoom
        })
        .catch(error => console.error("Error loading JSON:", error));
    
    function loadPart(part, parentContainer, offsetX = 0, offsetY = 0) {
        if (!part || !part.img) return;
    
        let container = new PIXI.Container();
        parentContainer.addChild(container);
    
        let sprite = PIXI.Sprite.from(part.img);
        container.addChild(sprite);
    
        let posX = offsetX;
        let posY = offsetY;
        let rotation = 0;
    
        // Load config if available
        fetch(part.cfg)
            .then(response => response.json())
            .then(config => {
                posX += config["offset-x"] || 0;
                posY += config["offset-y"] || 0;
                rotation = config.rotation || 0;
    
                sprite.x = posX;
                sprite.y = posY;
                sprite.rotation = rotation * (Math.PI / 180);
            })
            .catch(() => console.warn("Missing config, using defaults"));
    
        // Recursively load child parts
        for (const key in part) {
            if (typeof part[key] === 'object') {
                loadPart(part[key], container, posX, posY);
            }
        }
    }
    
    // Resize event to keep the doll centered and scaled
    window.addEventListener("resize", () => {
        app.renderer.resize(window.innerWidth, window.innerHeight);
        updateDollTransform();
    });
    
    // Function to set zoom level (0.0 to 1.0)
    function setZoom(level) {
        zoomLevel = Math.max(0.0, Math.min(1.0, level)); // Clamp between 0.0 and 1.0
        updateDollTransform();
    }
    
    // Example: Change zoom level with keyboard (Up/Down keys)
    window.addEventListener("keydown", (event) => {
        if (event.key === "ArrowUp") setZoom(zoomLevel + 0.1); // Zoom in
        if (event.key === "ArrowDown") setZoom(zoomLevel - 0.1); // Zoom out
    });
    
    </script>
</body>
</html>
